require 'json'
require 'open-uri'

item do
  expected do
    static
    url = 'https://download.gnome.org/sources/gtk-doc/cache.json'
    raw = JSON.parse(open(url).read)
    set raw[2]['gtk-doc'].select { |x| x.split('.')[1].to_i.even? }.last
  end

  actual do
    homebrew_formula
    name 'gtk-doc'
  end

  deps do
    item do
      name 'resource::six'

      expected do
        github_tag
        repo 'benjaminp/six'
      end

      actual do
        grep
        file 'Formula/gtk-doc.rb'
        regex /.*six-([\d.]+)\.tar\.gz"$/
      end
    end
  end
end
